<div class="sequencer-panel">
  <div class="topbar">
    <button mat-stroked-button [matMenuTriggerFor]="menu">A</button>
    <mat-menu #menu="matMenu">
      <button mat-menu-item disabled>Export</button>
      <button mat-menu-item disabled>Import</button>
      <button mat-menu-item disabled>Save</button>
      <button mat-menu-item disabled>SeeAllMyPanels</button>
    </mat-menu>

    <button mat-stroked-button type="button" (click)="openEventDialog()">E</button>
    <button mat-stroked-button type="button" (click)="openLabelDialog()">L</button>
    <button mat-stroked-button type="button" (click)="toggleRename()">N</button>

    <div class="panel-name">
      @if (showRenameInput()) {
        <input
          matInput
          [value]="renameDraft()"
          (input)="onRenameInput($event)"
          (blur)="saveRename()"
          (keydown.enter)="saveRename()"
        />
      } @else {
        <span>{{ panelName() }}</span>
      }
    </div>

    <button mat-stroked-button type="button" (click)="toggleEditMode()">M</button>
  </div>

  <div class="btn-list">
    @for (btn of sortedBtnList(); track btn.id) {
      <button
        type="button"
        class="btn-item"
        [class.pressed]="lastTriggeredBtnId() === btn.id"
        (click)="onBtnClick(btn)"
      >
        <div class="btn-info">
          <div class="btn-title">
            <span class="name">{{ btn.name }}</span>
            <span class="type">{{ btn.type }}</span>
          </div>
          <div class="btn-meta">
            <span>ID: {{ btn.id }}</span>
            <span>Hotkey: {{ formatHotkey(btn.hotkeyNormalized) }}</span>
          </div>
        </div>
        <div class="btn-actions">
          <span class="count">×{{ triggerCount(btn.id) }}</span>
          @if (showEditIcons()) {
            <button mat-icon-button type="button" (click)="openEditDialog(btn); $event.stopPropagation()">
              <mat-icon>edit</mat-icon>
            </button>
            <button mat-icon-button type="button" (click)="deleteBtn($event, btn)">
              <mat-icon>delete</mat-icon>
            </button>
          }
        </div>
      </button>
    }
  </div>

  <div class="recent-triggers">
    <h4>Recent triggers</h4>
    @if (!recentTriggers().length) {
      <div class="empty">Aucun trigger pour l’instant.</div>
    } @else {
      <ul>
        @for (entry of recentTriggers(); track entry.timestamp) {
          <li>
            <span class="time">{{ formatTimestamp(entry.timestamp) }}</span>
            <span class="source">{{ entry.source }}</span>
            <span class="name">{{ entry.name }}</span>
            <span class="id">({{ entry.btnId }})</span>
            @if (entry.normalizedHotkey) {
              <span class="hotkey">{{ formatHotkey(entry.normalizedHotkey) }}</span>
            }
          </li>
        }
      </ul>
    }
  </div>
</div>
