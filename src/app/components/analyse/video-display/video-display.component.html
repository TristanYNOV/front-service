<section
  #hotkeysZone
  tabindex="0"
  class="flex h-full w-full flex-col gap-1 bg-slate-950 p-2 text-xs light-text"
  (keydown)="onKeydown($event)"
  (click)="focusHotkeys()">
  <p class="font-semibold">
    {{ videoName() ?? 'Aucune vidéo chargée' }}
  </p>

  <div class="flex flex-1 flex-col">
    <div class="relative flex flex-1 items-center" (click)="focusHotkeys()">
      <video
        #videoElement
        class="h-full w-full object-contain"
        (loadedmetadata)="onVideoLoaded()"
        (error)="onVideoError()"
      >
        Votre navigateur ne supporte pas la lecture vidéo.
      </video>

      @if (errorMessage()) {
        <div class="absolute inset-0 flex flex-col items-center justify-center gap-3 bg-black/80 p-4 text-center">
          <p class="text-sm text-rose-200">{{ errorMessage() }}</p>
          <button type="button" class="btn-primary" (click)="onChangeVideoClick()">
            Choisir une autre vidéo
          </button>
        </div>
      } @else if (!hasVideo()) {
        <div class="absolute inset-0 flex flex-col items-center justify-center gap-3 text-center text-slate-300">
          <p>Importez une vidéo locale pour démarrer.</p>
        </div>
      }
    </div>

    <div class="flex flex-wrap items-center">
      @if (!hasVideo()) {
        <input
          #fileInput
          type="file"
          accept="video/*"
          class="w-full text-xs text-slate-200 file:mr-3 file:rounded-md file:border-0 file:bg-slate-700 file:px-3 file:py-1.5 file:text-sm file:font-semibold file:text-white hover:file:bg-slate-600"
          (change)="onFileSelected($event)"
        />
      } @else {
        <input type="file" accept="video/*" class="hidden" (change)="onFileSelected($event)"/>
        <button type="button" class="btn-secondary" (click)="onChangeVideoClick()">Changer de vidéo</button>
      }

      <div class="flex gap-1 ml-4 mr-2">
        <button type="button" class="btn-secondary" (click)="videoService.stepFrames(-1)" [disabled]="!hasVideo()">
          <
        </button>
        <button type="button" class="btn-primary" (click)="videoService.togglePlayPause()" [disabled]="!hasVideo()">
          {{ videoService.isPlaying() ? 'Pause' : 'Play' }}
        </button>
        <button type="button" class="btn-secondary" (click)="videoService.stepFrames(1)" [disabled]="!hasVideo()">
          >
        </button>
      </div>

      <div class="flex gap-1">
        <p>{{ formatDuration(videoService.positionMs()) }}</p>
        <p>/</p>
        <p>{{ formatDuration(videoService.durationMs()) }}</p>
      </div>

      <div class="flex items-center gap-1 ml-auto">
        <label class="flex items-center">
          <input
            type="number"
            min="0.25"
            max="2"
            step="0.25"
            class="text-right rounded-md border border-slate-700 bg-slate-900 py-0.5"
            [(ngModel)]="rateInput"
            (change)="onRateChange()"
            [disabled]="!hasVideo()"
          />
          x
        </label>
        @if (videoService.fps()) {
          <p>FPS estimé : {{ videoService.fps() }}</p>
        }
      </div>
    </div>


  </div>
</section>
