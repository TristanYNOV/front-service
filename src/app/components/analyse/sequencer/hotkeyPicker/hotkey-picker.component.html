<div class="flex flex-col gap-3">
  <mat-form-field appearance="fill" class="w-full">
    <mat-label>Base key</mat-label>
    <mat-select [value]="baseKey()" (valueChange)="onBaseKeyChange($event)">
      <mat-option [value]="null">Aucune</mat-option>
      @for (key of baseKeys; track key) {
        <mat-option [value]="key">{{ formatNormalized(key) }}</mat-option>
      }
    </mat-select>
  </mat-form-field>

  <div class="grid grid-cols-[repeat(auto-fit,minmax(90px,1fr))] gap-2">
    @for (modifier of modifiers; track modifier) {
      <mat-checkbox
        [checked]="modifierState()[modifier]"
        (change)="toggleModifier(modifier, $event.checked)"
      >
        {{ modifier }}
      </mat-checkbox>
    }
  </div>

  <div class="text-muted flex items-center gap-2.5 text-xs">
    <span class="font-semibold">Preview:</span>
    <span class="font-mono">{{ preview() || '—' }}</span>
    <button mat-stroked-button type="button" (click)="clear()">Retirer</button>
  </div>

  @if (status(); as status) {
    <div class="text-xs">
      @if (!status.isValid) {
        <span class="alert-text">Touche non autorisée.</span>
      } @else if (status.usedBy?.kind === 'reserved') {
        <span class="alert-text">Réservée vidéo: {{ status.usedBy?.label ?? '—' }}</span>
      } @else if (status.usedBy?.kind === 'sequencer') {
        <span class="alert-text">
          Déjà utilisée: {{ status.usedBy?.label ?? status.usedBy?.actionId ?? '—' }}
        </span>
      } @else {
        <span class="text-success">Disponible</span>
      }
    </div>
  }
</div>
