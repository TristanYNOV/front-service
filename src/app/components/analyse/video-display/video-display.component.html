<section class="bg-layer-0 text-default flex h-full w-full flex-col gap-1 p-2 text-xs">
  <div class="flex justify-around">
    <p class="font-semibold">
      {{ videoName() ?? 'Aucune vidéo chargée' }}
    </p>
    @if (videoService.fps()) {
      <p class="ml-auto">FPS estimé : {{ videoService.fps() }}</p>
    }
  </div>

  <div class="flex flex-1 flex-col">
    <div class="relative flex flex-1 items-center">
      <video
        #videoElement
        class="h-full w-full object-contain"
        (loadedmetadata)="onVideoLoaded()"
        (error)="onVideoError()"
      >
        Votre navigateur ne supporte pas la lecture vidéo.
      </video>

      @if (errorMessage()) {
        <div class="bg-overlay absolute inset-0 flex flex-col items-center justify-center gap-3 p-4 text-center">
          <p class="alert-text text-sm">{{ errorMessage() }}</p>
          <button type="button" class="btn-primary" (click)="onChangeVideoClick()">
            Choisir une autre vidéo
          </button>
        </div>
      } @else if (!hasVideo()) {
        <div class="text-muted absolute inset-0 flex flex-col items-center justify-center gap-3 text-center">
          <p>Importez une vidéo locale pour démarrer.</p>
        </div>
      }
    </div>

    <div class="flex flex-wrap items-center">
      @if (!hasVideo()) {
        <div class="mb-0.5 w-full">
          <input
            #fileInput
            type="file"
            accept="video/*"
            class="file-btn-primary w-1/3 text-xs"
            (change)="onFileSelected($event)"
          />
        </div>
      }

      <div class="mx-2 ml-4 flex gap-1">
        <button type="button" class="btn-default" (click)="videoService.stepFrames(-1)" [disabled]="!hasVideo()">
          <mat-icon class="text-md">chevron_left</mat-icon>
        </button>
        <button type="button" class="btn-primary" (click)="videoService.togglePlayPause()" [disabled]="!hasVideo()">
          @if (!videoService.isPlaying()) {
            <mat-icon class="text-md">play_arrow</mat-icon>
          } @else {
            <mat-icon class="text-md">pause</mat-icon>
          }
        </button>
        <button type="button" class="btn-default" (click)="videoService.stepFrames(1)" [disabled]="!hasVideo()">
          <mat-icon class="text-md">chevron_right</mat-icon>
        </button>
      </div>

      <div class="flex flex-1 items-center gap-2">
        <p>{{ formatDuration(videoService.positionMs()) }}</p>
        <div class="flex flex-1 items-center">
          <input
            type="range"
            class="w-full"
            [min]="0"
            [max]="videoService.durationMs() || 0"
            [value]="videoService.positionMs()"
            [disabled]="!hasVideo()"
            (input)="onSeekInput($event)"
          />
        </div>
        <p>{{ formatDuration(videoService.durationMs()) }}</p>
      </div>

      <div class="ml-3 flex items-center gap-2">
        <span class="flex items-center">
          {{ rateInput }}x
        </span>
        <div class="flex flex-col">
          <button (click)="upRateChange()">
            <mat-icon class="icon text-xs">add</mat-icon>
          </button>
          <button (click)="reduceRateChange()">
            <mat-icon class="icon text-xs">remove</mat-icon>
          </button>
        </div>
      </div>
    </div>
  </div>
</section>
