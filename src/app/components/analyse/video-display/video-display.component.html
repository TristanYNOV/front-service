<section
  #hotkeysZone
  tabindex="0"
  class="flex h-full w-full flex-col gap-1 bg-slate-950 p-2 text-xs light-text"
  (keydown)="onKeydown($event)"
  (click)="focusHotkeys()">
  <div class="flex justify-around">
    <p class="font-semibold">
      {{ videoName() ?? 'Aucune vidéo chargée' }}
    </p>
    @if (videoService.fps()) {
      <p class="ml-auto">FPS estimé : {{ videoService.fps() }}</p>
    }
  </div>

  <div class="flex flex-1 flex-col">
    <div class="relative flex flex-1 items-center" (click)="focusHotkeys()">
      <video
        #videoElement
        class="h-full w-full object-contain"
        (loadedmetadata)="onVideoLoaded()"
        (error)="onVideoError()"
      >
        Votre navigateur ne supporte pas la lecture vidéo.
      </video>

      @if (errorMessage()) {
        <div class="absolute inset-0 flex flex-col items-center justify-center gap-3 bg-black/80 p-4 text-center">
          <p class="text-sm text-rose-200">{{ errorMessage() }}</p>
          <button type="button" class="btn-primary" (click)="onChangeVideoClick()">
            Choisir une autre vidéo
          </button>
        </div>
      } @else if (!hasVideo()) {
        <div class="absolute inset-0 flex flex-col items-center justify-center gap-3 text-center text-slate-300">
          <p>Importez une vidéo locale pour démarrer.</p>
        </div>
      }
    </div>

    <div class="flex flex-wrap items-center">
      @if (!hasVideo()) {
        <div class="w-full mb-0.5">
          <input
            #fileInput
            type="file"
            accept="video/*"
            class="w-1/3 text-xs file-btn-primary"
            (change)="onFileSelected($event)"
          />
        </div>
      }

      <div class="flex gap-1 ml-4 mr-2">
        <button type="button" class="btn-default" (click)="videoService.stepFrames(-1)" [disabled]="!hasVideo()">
          <mat-icon class="text-md">chevron_left</mat-icon>
        </button>
        <button type="button" class="btn-primary" (click)="videoService.togglePlayPause()" [disabled]="!hasVideo()">
          @if (!videoService.isPlaying()) {
            <mat-icon class="text-md">pause</mat-icon>
          } @else {
            <mat-icon class="text-md">play_arrow</mat-icon>
          }
        </button>
        <button type="button" class="btn-default" (click)="videoService.stepFrames(1)" [disabled]="!hasVideo()">
          <mat-icon class="text-md">chevron_right</mat-icon>
        </button>
      </div>

      <div class="flex items-center gap-2 flex-1">
        <p>{{ formatDuration(videoService.positionMs()) }}</p>
        <div class="flex flex-1 items-center">
          <input
            type="range"
            class="w-full"
            [min]="0"
            [max]="videoService.durationMs() || 0"
            [value]="videoService.positionMs()"
            [disabled]="!hasVideo()"
            (input)="onSeekInput($event)"
          />
        </div>
        <p>{{ formatDuration(videoService.durationMs()) }}</p>
      </div>

      <div class="flex items-center gap-2 ml-3">
        <span class="flex items-center">
          {{ rateInput }}x
        </span>
        <div class="flex flex-col">
          <button (click)="upRateChange()">
            <mat-icon class="text-xs icon" >add</mat-icon>
          </button>
          <button (click)="reduceRateChange()">
            <mat-icon class="text-xs icon">remove</mat-icon>
          </button>
        </div>
      </div>
    </div>

  </div>
</section>
